# 🐐📸 山羊照片上傳功能 - 完整指南

## 📋 功能概述

山羊照片上傳功能是整合到 AI 問答助理的多模態分析工具，讓您可以上傳山羊照片，由 Google Gemini Vision API 進行智能分析。系統會根據照片中的山羊外觀、環境條件和健康指標，提供專業的飼養建議。

### 🎯 主要特色
- **多模態 AI 分析**：結合圖像識別和文字問答
- **專業建議**：基於領頭羊博士的專業知識
- **即時處理**：上傳後即時獲得分析結果
- **安全可靠**：檔案驗證和大小限制
- **用戶友善**：直觀的拖放界面

---

## 🚀 快速開始

### 步驟 1: 準備工作
1. 確保已在「系統設定」中設定有效的 **Gemini API 金鑰**
2. 準備清晰的山羊照片（建議解析度 1024x1024 以上）
3. 確認照片檔案格式為支援格式

### 步驟 2: 進入功能頁面
1. 登入系統後，點擊左側選單的「**AI 問答助理**」
2. 在聊天界面中找到照片上傳功能

### 步驟 3: 上傳照片
1. 點擊「**上傳照片**」按鈕（📷 相機圖示）
2. 在彈出的檔案選擇器中選擇照片
3. 照片會立即顯示預覽

### 步驟 4: 發送分析請求
1. **純圖片分析**：直接點擊「發送」，系統會自動請求 AI 分析
2. **圖文結合**：輸入具體問題，如「這隻羊的健康狀況如何？」

---

## 🛠️ 詳細使用說明

### 照片上傳界面

#### 上傳按鈕
- **位置**：聊天輸入框右側
- **圖示**：📷 相機圖標
- **功能**：點擊開啟系統檔案選擇器

#### 照片預覽區域
```
┌─────────────────────────────┐
│ 🖼️ 圖片預覽                  │
│ ┌─────────────┐ ❌          │
│ │             │             │
│ │   山羊照片   │             │
│ │             │             │
│ └─────────────┘             │
│ 檔案名.jpg (1.2 MB)          │
└─────────────────────────────┘
```

#### 功能按鈕
- **移除照片**：點擊預覽區域右上角的 ❌ 按鈕
- **重新選擇**：移除後可重新點擊上傳按鈕
- **發送分析**：點擊「發送」按鈕提交分析請求

### 支援的檔案格式

| 格式 | 副檔名 | 建議用途 |
|------|--------|----------|
| JPEG | .jpg, .jpeg | 一般照片，檔案較小 |
| PNG | .png | 高品質圖片，支援透明背景 |
| GIF | .gif | 動態圖片（僅分析第一幀） |
| WebP | .webp | 現代格式，壓縮率高 |

### 檔案限制

- **大小限制**：10 MB 以內
- **解析度建議**：512x512 ~ 4096x4096 像素
- **檔案命名**：支援中文和英文檔名
- **數量限制**：每次上傳一張照片

---

## 🤖 AI 分析功能

### 分析項目

#### 1. 外觀特徵分析
- **品種識別**：根據外觀特徵判斷可能的品種
- **年齡評估**：透過體型和外觀估算年齡範圍
- **性別判斷**：基於生理特徵判斷性別
- **體況評分**：評估營養狀況和體重

#### 2. 健康狀況評估
- **毛色光澤**：毛質健康狀況
- **眼神狀態**：精神狀況評估
- **姿態分析**：站立和行為姿態
- **皮膚狀況**：可見皮膚區域的健康度

#### 3. 環境條件分析
- **飼養環境**：圍欄、地面、遮蔽設施
- **衛生狀況**：環境清潔度評估
- **空間充足性**：活動空間評估
- **設施完整性**：飼料槽、水槽等設施

#### 4. 專業建議
- **營養管理**：飼料配方建議
- **健康監控**：需要注意的健康指標
- **環境改善**：飼養環境優化建議
- **預防措施**：疾病預防和管理建議

### 分析報告範例

```markdown
## 📊 山羊分析報告

### 基本資訊
- **品種推測**：台灣黑山羊
- **估計年齡**：成年（2-4歲）
- **性別**：母羊
- **體況評分**：3.5/5（良好）

### 健康狀況
✅ **良好指標**
- 毛色光澤佳，營養狀況良好
- 眼神清澈，精神良好
- 站立姿態正常

⚠️ **需要注意**
- 左後腿似乎有輕微不適
- 建議檢查蹄部健康

### 環境評估
- 圍欄設施：完善
- 地面狀況：需要改善排水
- 遮蔽設施：充足

### 建議措施
1. 檢查蹄部，必要時修蹄
2. 改善地面排水系統
3. 維持現有營養管理
```

---

## 🔧 技術實作詳情

### 前端技術棧
- **Vue.js 3**：響應式前端框架
- **Element Plus**：UI 組件庫
- **Pinia**：狀態管理
- **Vite**：建構工具

### 後端技術棧
- **Flask**：Python Web 框架
- **SQLAlchemy**：資料庫 ORM
- **Flask-Login**：使用者認證
- **Pydantic**：資料驗證

### API 整合
- **Google Gemini Vision API**：圖像分析
- **Base64 編碼**：圖片傳輸
- **FormData**：多媒體上傳

---

## 📁 相關程式碼檔案

### 前端檔案

#### 1. 主要組件檔案
```
frontend/src/views/ChatView.vue
├── 照片上傳按鈕 UI
├── 檔案選擇器邏輯
├── 圖片預覽功能
├── 拖放支援
└── 錯誤處理
```

#### 2. 狀態管理
```
frontend/src/stores/chat.js
├── sendMessage 方法擴展
├── 圖片資料處理
├── 聊天記錄管理
└── 錯誤狀態處理
```

#### 3. API 層
```
frontend/src/api/index.js
├── chatWithAgent 方法
├── FormData 處理
├── 多媒體上傳邏輯
└── 請求攔截器
```

### 後端檔案

#### 1. API 端點
```
backend/app/api/agent.py
├── /chat 路由處理
├── 圖片檔案驗證
├── Base64 編碼轉換
├── Gemini API 整合
└── 聊天記錄儲存
```

#### 2. 工具函數
```
backend/app/utils.py
├── call_gemini_api 擴展
├── encode_image_to_base64
└── 圖片處理工具
```

#### 3. 資料模型
```
backend/app/models.py
├── ChatHistory 模型
└── 使用者認證模型
```

#### 4. 資料驗證
```
backend/app/schemas.py
├── AgentChatModel
└── 請求資料驗證
```

### 配置檔案

#### 1. 前端配置
```
frontend/package.json          # 依賴管理
frontend/vite.config.js        # 建構配置
frontend/vitest.config.js      # 測試配置
```

#### 2. 後端配置
```
backend/requirements.txt       # Python 依賴
backend/Dockerfile            # 容器配置
backend/.env                  # 環境變數
```

### 測試檔案
```
test_image_upload.py          # 基本功能測試
frontend/src/stores/chat.test.js  # 前端單元測試
```

---

## 🛡️ 安全性考量

### 檔案安全
- **類型驗證**：僅允許圖片格式
- **大小限制**：防止大檔案攻擊
- **內容檢查**：基本的檔案頭驗證

### 資料隱私
- **暫時處理**：圖片不會永久儲存
- **Base64 傳輸**：安全的編碼傳輸
- **使用者隔離**：每個使用者的資料獨立

### API 安全
- **金鑰驗證**：必須提供有效的 API 金鑰
- **使用者認證**：需要登入才能使用
- **請求限制**：合理的請求頻率限制

---

## 🐛 故障排除

### 常見問題

#### Q1: 上傳按鈕沒有反應
**解決方案：**
1. 檢查 API 金鑰是否已設定
2. 確認瀏覽器是否支援檔案上傳
3. 檢查網路連線狀況

#### Q2: 圖片上傳後沒有預覽
**解決方案：**
1. 確認檔案格式是否支援
2. 檢查檔案大小是否超過 10MB
3. 嘗試重新選擇檔案

#### Q3: AI 分析結果不準確
**解決方案：**
1. 使用更清晰的照片
2. 確保照片中山羊清楚可見
3. 避免過度曝光或昏暗的照片

#### Q4: 上傳失敗錯誤
**錯誤代碼對照：**
- `400`: 檔案格式不支援或缺少參數
- `413`: 檔案過大
- `401`: API 金鑰無效
- `500`: 伺服器內部錯誤

### 效能優化建議

1. **圖片最佳化**
   - 建議解析度：1024x1024
   - 檔案大小：1-5MB
   - 格式建議：JPEG（最佳相容性）

2. **網路優化**
   - 使用穩定的網路連線
   - 避免在網路繁忙時上傳大檔案

3. **瀏覽器建議**
   - Chrome 90+、Firefox 88+、Safari 14+
   - 啟用 JavaScript

---

## 🔄 版本更新記錄

### v1.0.0 (2025-08-01)
- ✨ 初始版本發布
- 🎯 支援 JPEG、PNG、GIF、WebP 格式
- 🛡️ 10MB 檔案大小限制
- 🤖 整合 Gemini Vision API
- 📱 響應式設計支援

### 未來規劃
- 📊 批次照片上傳
- 🎯 更精確的品種識別
- 📈 歷史照片比較功能
- 🔍 局部特徵放大分析

---

## 📞 技術支援

如果您在使用過程中遇到問題，請提供以下資訊：
1. 瀏覽器類型和版本
2. 上傳的檔案格式和大小
3. 具體的錯誤訊息
4. 操作步驟截圖

**聯絡方式：**
- GitHub Issues: https://github.com/nj1i6t6/Goat_Nutrition_App_Optimization_Test/issues
- 技術文檔：查看 `/docs` 目錄下的其他文檔

---

*最後更新：2025年8月1日*
*文檔版本：v1.0.0*
